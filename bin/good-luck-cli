#!/usr/bin/env node
const figlet = require('figlet');
const Printer = require('@darkobits/lolcatjs');
const { program } = require('commander');
const _version = require('../package.json').version;
const chalk = require('chalk'); // chalk 4.xå¯ä»¥ä½¿ç”¨requireï¼Œ5.xä¸å¯ä»¥
const rimraf = require('rimraf'); // Windowsåˆ é™¤å¤§æ–‡ä»¶ä½¿ç”¨

const versionStr = figlet.textSync('Hello');

// @darkobits/lolcatjs 3.1.3ä½¿ç”¨defaultï¼Œ3.1.5ç›´æ¥ä½¿ç”¨Printer.fromString
program.version(Printer.default.fromString(`     MYæ‰‹æ¶${_version}` + '\n' + versionStr));
program.option('init', 'åˆå§‹åŒ–é¡¹ç›®')
program.option('del <path> [<path> ...]', 'åˆ é™¤å¤§æ–‡ä»¶')

// ç”¨æˆ·è¾“å…¥å­—å…¸
const bindHandler = {
    init() {
        console.log('åˆå§‹åŒ–é¡¹ç›®')
    },
    del() {
        const args = process.argv.slice(3)
        args.forEach(item => {
            rimraf(item, {}, (err) => {
                if (err) {
                    console.log('å‡ºç°äº†é”™è¯¯')
                    throw err;
                } else {
                    console.log('åˆ é™¤' + chalk.green(` ${item} `) + 'æˆåŠŸäº†~ğŸ˜')
                }
            })
        })

    },
}
program
    .usage('[cmd] <options>')
    .arguments('<cmd> [env]')
    .action(function (cmd, otherParams) {
        let handle = bindHandler[cmd];
        if (typeof handle === 'undefined') {
            console.log(chalk.blue('æ‚¨è¾“å…¥çš„ï¼š') + chalk.red(`${cmd}ï¼Œ`) + chalk.yellow(`å‘½ä»¤æš‚æ—¶ä¸æ”¯æŒ`));
        } else {
            handle(otherParams);
        }
    })


program.parse(process.argv);
